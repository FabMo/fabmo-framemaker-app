<!DOCTYPE html>
<html lang="en"> 
<head>
<meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8"/>


<script src="js/jquery-1.11.2.min.js"></script>
<script src="js/libs/fabmo.js"></script>
    <script type="text/javascript">
        var fabmo = new FabMoDashboard();
    </script>
<script src="js/control.js"></script>
<script src="js/config.js"></script>


<style>

#myCanvas{
/*
border: 1px solid black;
*/
}

input{
position: absolute;
width: 72px;
height: 24px;
z-index:1;
}

#input_submit{
right: 30px;
bottom: 30px;
width:100px;
height:100px;


}

</style>

</head>

<body onload="reload();">

<input id="input_width" type="number" value="50" autocomplete="off" step="0.1"/>
<input id="input_height" type="number" value="50" autocomplete="off" step="0.1"/>
<input id="input_radius" type="number" value="5" autocomplete="off" step="0.1"/>
<input id="input_submit" type="submit" value="SUBMIT&#x00A;JOB" onclick="make()"/>

<canvas id="myCanvas"></canvas>
   

<script>

var g = ""
var tool_diameter
var cutout = []
var verts = 100
var xmin = -25
var ymin = -25
var xmax = 25
var ymax = 25
var radius = 5

var c
var ctx
var sf

var input_width
var input_height
var input_radius

function reload(){

   cutout = []

   makeFrame()

}


function makeFrame() {

for (i=0;i<=verts;i++) {
   if(i<=25){
      cutout.push({X:((xmax-radius)+Math.sin((Math.PI*2)/verts*i)*radius),Y:((ymax-radius)+Math.cos((Math.PI*2)/verts*i)*radius)});
   }
   else if((i>25)&&(i<=50)){
      cutout.push({X:((xmax-radius)+Math.sin((Math.PI*2)/verts*i)*radius),Y:((ymin+radius)+Math.cos((Math.PI*2)/verts*i)*radius)});
   }
   else if((i>50)&&(i<=75)){
      cutout.push({X:((xmin+radius)+Math.sin((Math.PI*2)/verts*i)*radius),Y:((ymin+radius)+Math.cos((Math.PI*2)/verts*i)*radius)});    
   }
   else if((i>75)&&(i<=100)){
      cutout.push({X:((xmin+radius)+Math.sin((Math.PI*2)/verts*i)*radius),Y:((ymax-radius)+Math.cos((Math.PI*2)/verts*i)*radius)});     

      if(i==100){
      cutout.push(cutout[0])
      }
      
   }
   
   
}

//console.log(cutout)

draw()

}


function draw(){

var input_width_style = document.getElementById("input_width").style;
var input_height_style = document.getElementById("input_height").style;
var input_radius_style = document.getElementById("input_radius").style;

//console.log(input_height_style)

c = document.getElementById("myCanvas");
ctx = c.getContext("2d");
ctx.fillStyle = "#FF0000";

ctx.canvas.height = $(window).innerHeight()-30
ctx.canvas.width = $(window).innerWidth()-30

if(((ctx.canvas.height)/((ymax-ymin))*xmax*2)+100>ctx.canvas.width){
	sf = (ctx.canvas.width-230)/((xmax*2))
}
else{
	sf = (ctx.canvas.height-90)/((ymax*2))
}

input_width_style.left=((ctx.canvas.width/2)-30 + "px")
input_width_style.top=(ctx.canvas.height/2+(ymax*sf)+24 + "px")

input_height_style.left=((ctx.canvas.width/2)-(xmax*sf)-100 + "px")
input_height_style.top=(ctx.canvas.height/2-12 + "px")

input_radius_style.left=((ctx.canvas.width/2)+(xmax*sf)+30 + "px")
input_radius_style.top=(ctx.canvas.height/2-(ymax*sf)+10 + "px")


ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);

ctx.beginPath()
	ctx.lineWidth="1"
	ctx.strokeStyle="red"
	ctx.lineTo((ctx.canvas.width/2)+(xmin*sf),(ctx.canvas.height/2+(ymax*sf)+32))
	ctx.lineTo((ctx.canvas.width/2)+(xmax*sf),(ctx.canvas.height/2+(ymax*sf)+32))
	ctx.lineTo((ctx.canvas.width/2)+(xmax*sf),(ctx.canvas.height/2+(ymax*sf)+22))
	ctx.moveTo((ctx.canvas.width/2)+(xmin*sf),(ctx.canvas.height/2+(ymax*sf)+32))
	ctx.lineTo((ctx.canvas.width/2)+(xmin*sf),(ctx.canvas.height/2+(ymax*sf)+22))
ctx.stroke()

ctx.beginPath()
	ctx.lineWidth="1"
	ctx.strokeStyle="green"
	ctx.lineTo((ctx.canvas.width/2-37)-(sf*(xmax)),ctx.canvas.height/2+(ymin*sf))
	ctx.lineTo((ctx.canvas.width/2-37)-(sf*(xmax)),ctx.canvas.height/2+(ymax*sf))
	ctx.lineTo((ctx.canvas.width/2-27)-(sf*(xmax)),ctx.canvas.height/2+(ymax*sf))
	ctx.moveTo((ctx.canvas.width/2-27)-(sf*(xmax)),ctx.canvas.height/2+(ymin*sf))
	ctx.lineTo((ctx.canvas.width/2-37)-(sf*(xmax)),ctx.canvas.height/2+(ymin*sf))
ctx.stroke()

ctx.beginPath()
	ctx.lineWidth="1"
	ctx.strokeStyle="purple"
	ctx.lineTo((cutout[40].X*sf)+ctx.canvas.width/2,(cutout[40].Y*sf)+ctx.canvas.height/2)
	ctx.lineTo((ctx.canvas.width/2)+(xmax*sf)+30,ctx.canvas.height/2-(ymax*sf)+18)
ctx.stroke()




ctx.beginPath()
ctx.lineWidth="3"
ctx.strokeStyle="blue"

for(i=0;i<cutout.length;i++){
	ctx.lineTo((cutout[i].X*sf)+ctx.canvas.width/2,(cutout[i].Y*sf)+ctx.canvas.height/2);
}
ctx.stroke()
}

$("#input_width").on("change", function(){
	 xmax = (document.getElementById("input_width").value/2)
	 xmin = 0-xmax
	 cutout=[]
    setTimeout(makeFrame(), 100);
})



$("#input_height").on("change", function(){
	 ymax = (document.getElementById("input_height").value/2)
	 ymin = 0-ymax
	 cutout=[]
    setTimeout(makeFrame(), 100);
})

$("#input_radius").on("change", function(){
	 radius = parseFloat(document.getElementById("input_radius").value)
	 cutout=[]
    setTimeout(makeFrame(), 100);
})




$(window).resize(function(){

	draw()
}); 



function make(){

cutout.reverse()

/*
var material = eval('({' + (document.getElementById("material").value) + '})');
var pass = 1
var pass_no = document.getElementById("thickness").value

if(pass_no==0){
   pass_no=1
   var pass_depth = document.getElementById("thickness").value/pass_no
}
*/
var material = {feed:500,plunge:200}
var pass = 1
var pass_no=1
var pass_depth=1



//part A
//header
g+="g21\n"
g+="g0z3\n"
g+="m4\n"
g+="g4p2\n"

   g+="g0x"+(cutout[0].X.toFixed(2))+"y"+ (cutout[0].Y).toFixed(2) + "\n"

while(pass<=pass_no){
   
   g+="g1z-"+ (pass_depth*pass) + "f" + material.plunge + "\n"
   for(i=1;i<cutout.length;i++){
      g+="g1x"+(cutout[i].X).toFixed(2) +"y"+ (cutout[i].Y).toFixed(2) + "f" + material.feed +  "\n"
   }
   pass++
}



g+="g0z5\n"
g+="m5\n"
g+="m30\n"

//console.log(g)

fabmo.submitJob({
   file : g,
   filename : 'frame.g',
   name : "frame",
   description : (xmax*2) + " x " + (ymax*2) + " x " + "mm" 
});

g=""
cutout.reverse()

}

// toggle full screen
function toggleFullScreen() {
  if (!document.fullscreenElement &&    // alternative standard method
      !document.mozFullScreenElement && !document.webkitFullscreenElement) {  // current working methods
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen();
    } else if (document.documentElement.mozRequestFullScreen) {
      document.documentElement.mozRequestFullScreen();
    } else if (document.documentElement.webkitRequestFullscreen) {
      document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
    }
  } else {
    if (document.cancelFullScreen) {
      document.cancelFullScreen();
    } else if (document.mozCancelFullScreen) {
      document.mozCancelFullScreen();
    } else if (document.webkitCancelFullScreen) {
      document.webkitCancelFullScreen();
    }
  }
}

</script>


</body>
</html>

